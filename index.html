<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knitting Progress Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --pastel-pink-bg: #FCE4EC;
            --soft-pink-card: #FFF1F1;
            --hot-pink-accent: #F06292;
            --deep-pink-text: #880E4F;
            --nav-blue-pastel: #90CAF9;
            --inc-color: #C2185B;
            --dec-color: #1565C0;
            --neut-color: #4A148C;
        }

        body {
            /* Applied handwritten font */
            font-family: 'Kalam', cursive;
            background-color: var(--pastel-pink-bg);
            color: var(--deep-pink-text);
            display: flex;
            justify-content: center;
            padding: 20px;
            margin: 0;
        }

        .container {
            background: white;
            width: 100%;
            max-width: 500px;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            text-align: center;
            position: relative;
            z-index: 10;
        }

        h1, h2 {
            font-weight: 700;
        }

        /* Menu Display */
        #menu-screen { display: block; }
        #tracker-screen { display: none; }

        .menu-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .menu-btn {
            font-family: 'Kalam', cursive;
            background: var(--soft-pink-card);
            border: 2px solid var(--hot-pink-accent);
            padding: 25px 10px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--deep-pink-text);
            transition: all 0.2s;
        }

        .menu-btn:hover {
            background: var(--hot-pink-accent);
            color: white;
        }

        /* Tracker Display */
        .size-selector { margin-bottom: 15px; }

        .card {
            background-color: #fff9c4; /* Pale yellow sticky-note color */
            padding: 20px;
            border-radius: 5px;
            min-height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            margin-bottom: 10px;
            line-height: 1.4;
            box-shadow: 2px 5px 10px rgba(0,0,0,0.05);
            border-left: 5px solid #fbc02d;
        }

        .progress-subtext {
            font-size: 0.95rem;
            margin-bottom: 20px;
        }

        .shaping-section {
            margin-bottom: 20px;
            display: none;
        }

        progress {
            width: 100%;
            height: 20px;
            accent-color: var(--hot-pink-accent);
        }

        .reminder {
            font-weight: bold;
            font-size: 1.3rem;
            min-height: 60px;
            margin: 15px 0;
            white-space: pre-wrap;
        }

        .row-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
        }

        .btn {
            font-family: 'Kalam', cursive;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: opacity 0.2s;
        }

        .btn:disabled { opacity: 0.3; cursor: not-allowed; }
        .btn-row { background-color: #F8BBD0; color: var(--deep-pink-text); font-size: 1.3rem; }
        .btn-nav { background-color: var(--nav-blue-pastel); color: white; flex: 1; font-size: 1.1rem; }
        .btn-prev { background-color: #e0e0e0; color: #666; }
        .btn-reset { background-color: #FFCDD2; color: var(--deep-pink-text); font-size: 1rem; }

        .nav-group { display: flex; gap: 10px; margin-top: 10px; }

        .abbr-box {
            text-align: left;
            font-size: 0.9rem;
            background: #fdfdfd;
            padding: 15px;
            border-radius: 10px;
            border: 1px dashed #ccc;
            margin-top: 20px;
            white-space: pre-wrap;
        }

        canvas {
            position: fixed;
            top: 0; left: 0;
            pointer-events: none;
            z-index: 100;
        }
    </style>
</head>
<body>

<canvas id="confetti"></canvas>

<div class="container">
    
    <div id="menu-screen">
        <h1 style="color: var(--hot-pink-accent)">Knitting Tracker</h1>
        <p>Choose a pattern to begin:</p>
        <div class="menu-grid">
            <button class="menu-btn" onclick="startProject('hood')">Sophie Hood</button>
            <button class="menu-btn" onclick="startProject('scarf')">Sophie Scarf</button>
            <button class="menu-btn" onclick="startProject('beanie')">Beanie</button>
            <button class="menu-btn" onclick="startProject('balaclava')">Balaclava</button>
        </div>
    </div>

    <div id="tracker-screen">
        <h2 id="project-title">Project Guide</h2>

        <div class="size-selector">
            <label>Size: </label>
            <input type="radio" name="size" id="size0" value="0" checked onchange="updateSize(0)"> S
            <input type="radio" name="size" id="size1" value="1" onchange="updateSize(1)"> M
            <input type="radio" name="size" id="size2" value="2" onchange="updateSize(2)"> L
        </div>

        <div class="card" id="step-text"></div>
        <div class="progress-subtext" id="step-count"></div>

        <div id="shaping-area" class="shaping-section">
            <div id="shaping-label"></div>
            <progress id="shaping-bar" value="0" max="100"></progress>
        </div>

        <div class="reminder" id="reminder-text"></div>

        <div class="row-controls">
            <button class="btn btn-row" onclick="changeRow(1)">+ Row</button>
            <div style="font-size: 1.5rem; font-weight: bold;" id="row-display">Rows: 0</div>
            <button class="btn btn-row" onclick="changeRow(-1)">- Row</button>
            <button class="btn btn-reset" onclick="resetCounter()">üîÑ</button>
        </div>

        <div class="nav-group">
            <button class="btn btn-nav btn-prev" id="prev-btn" onclick="prevStep()">‚¨Ö Previous</button>
            <button class="btn btn-nav" id="next-btn" onclick="nextStep()">Next ‚û°</button>
        </div>
        
        <button class="btn btn-reset" style="margin-top:15px; width:100%" onclick="exitToMenu()">Back to Menu</button>

        <div class="abbr-box" id="abbr-content"></div>
    </div>
</div>

<script>
    const patterns = {
        hood: {
            title: "Sophie Hood Guide",
            abbr: "<strong>ABBREVIATIONS</strong>\nk: knit\nk2tog: knit 2 together\nkfb: knit front and back\np: purl\nRS: right side\nWS: wrong side\nskp: slip 1, k1, pass slipped st over\nwyif: with yarn in front",
            steps: [
                "Welcome to the Sophie Hood Guide üß∂\n\nSizes: S, M, L\nGauge: 17 sts = 10cm\nNeedles: 5mm\n\nChoose your size at the top and click Next to start.",
                "Cast On\n\nCast on 6 stitches.\n\nWork Row 1 & 2 (Knit to last 3, slip 3 purl-wise wyif) a total of 3 times (6 rows total).",
                "Scarf Section (Increases)\n\nWork increases on every 6th (8th) 10th row:\n\nRow 1 (WS): K2, kfb, knit to last 3, slip 3 wyif.\nRows 2-6: Work even.\n\nRepeat until you have 45 stitches (approx 25cm wide).",
                "Right Hood Body\n\nRow 1 (WS): Place first 3 sts on holder, knit to last 3, slip 3 wyif. (42 sts remain)\nRow 2 (RS): Knit across.\nRow 3 (WS): Knit to last 3, slip 3 wyif.\n\nRepeat Rows 2 & 3 until you count 16 garter ridges from the holder.",
                "Hood Shaping: 4-Row Decreases\n\nRow 1 (RS): Knit to last 3, k2tog, k1.\nRow 2 (WS): Knit to last 3, slip 3 wyif.\nRow 3 (RS): Knit across.\nRow 4 (WS): Work as Row 2.\n\nRepeat 3 times total (39 sts remaining).",
                "Hood Shaping: 2-Row Decreases\n\nRow 1 (RS): Knit to last 3, k2tog, k1.\nRow 2 (WS): Knit to last 3, slip 3 wyif.\n\nRepeat 6 times total (33 sts remaining).",
                "Hood Shaping: Every Row Decreases\n\nRow 1 (RS): Knit to last 3, k2tog, k1.\nRow 2 (WS): K1, k2tog, knit to last 3, slip 3 wyif.\n\nRepeat 5 times total (23 sts remaining). Point reached!",
                "Hood Shaping: Every Row Increases\n\nRow 1 (RS): Knit to last 2, kfb, k1.\nRow 2 (WS): K1, kfb, knit to last 3, slip 3 wyif.\n\nRepeat 5 times total (33 sts total).",
                "Hood Shaping: 2-Row Increases\n\nRow 1 (RS): Knit to last 2, kfb, k1.\nRow 2 (WS): Knit to last 3, slip 3 wyif.\n\nRepeat 6 times total (39 sts total).",
                "Hood Shaping: 4-Row Increases\n\nRow 1 (RS): Knit across.\nRow 2 (WS): Knit to last 3, slip 3 wyif.\nRow 3 (RS): Knit to last 2, kfb, k1.\nRow 4 (WS): Work as Row 2.\n\nRepeat 3 times total (42 sts total).",
                "Left Hood Body\n\nRow 1 (RS): Knit across.\nRow 2 (WS): Knit to last 3, slip 3 wyif.\n\nRepeat 17 times total.",
                "Rejoin Scarf\n\nRow 1 (RS): Knit to end, hold yarn in front, pick up the 3 resting sts from holder. (45 sts total)\nRow 2 (WS): Knit to last 3, slip 3 wyif.\nRow 3 (RS): Work as Row 2.\n\nRepeat Rows 2 & 3 as per pattern size (6, 8, or 10 rows total).",
                "Second Scarf Tail (Decreases)\n\nWork decreases on every 6th (8th) 10th row:\n\nRow 1 (WS): K3, skp, knit to last 3, slip 3 wyif.\nRows 2-6: Work even.\n\nRepeat until 7 sts remain.",
                "Final Taper & Bind Off\n\nWork final 6 rows as per pattern, decreasing on Row 1.\n\nBind off 3 knit-wise, bind off 3 purl-wise.",
                "Finishing\n\nSew the back of the hood using mattress stitch.\n\nGuide: <a href='https://www.youtube.com/watch?v=8bVaQep2MWw' target='_blank'>Watch Video</a>",
                "Finished üéâ\n\nYour Sophie Hood is complete!"
            ],
            shaping: {
                2: { label: "Scarf Increases", total: 250 },
                3: { label: "Right Hood Ridges", total: 32 },
                4: { label: "4-Row Decreases", total: 12 },
                5: { label: "2-Row Decreases", total: 12 },
                6: { label: "Every Row Decreases", total: 10 },
                7: { label: "Every Row Increases", total: 10 },
                8: { label: "2-Row Increases", total: 12 },
                9: { label: "4-Row Increases", total: 12 },
                10: { label: "Left Hood Body", total: 34 },
                11: { label: "Rejoin Rows", total: 10 },
                12: { label: "Tail Decreases", total: 250 }
            }
        },
        scarf: { title: "Sophie Scarf Guide", abbr: "<strong>ABBREVIATIONS</strong>\nk: knit\nk2tog: knit 2 together\nkfb: knit front and back\np: purl\nRS: right side\nWS: wrong side\nskp: slip 1, k1, pass slipped st over\nwyif: with yarn in front", steps: ["Start...", "Middle...", "End..."], shaping: {} },
        beanie: { title: "Beanie Guide", abbr: "<strong>ABBREVIATIONS</strong>\nk: knit\nk2tog: knit 2 together\nkfb: knit front and back\np: purl\nRS: right side\nWS: wrong side\nskp: slip 1, k1, pass slipped st over\nwyif: with yarn in front", steps: ["Cast on...", "Rib...", "Crown..."], shaping: {} },
        balaclava: { title: "Balaclava Guide", abbr: "<strong>ABBREVIATIONS</strong>\nk: knit\nk2tog: knit 2 together\nkfb: knit front and back\np: purl\nRS: right side\nWS: wrong side\nskp: slip 1, k1, pass slipped st over\nwyif: with yarn in front", steps: ["Neck...", "Face...", "Top..."], shaping: {} }
    };

    let state = JSON.parse(localStorage.getItem('sophieState')) || { project: null, step: 0, rows: 0, size: 0 };
    let confettiActive = false;
    let confettiAnimId = null;

    function startProject(type) {
        state.project = type;
        state.step = 0;
        state.rows = 0;
        loadTracker();
    }

    function exitToMenu() {
        if(confirm("Back to menu? Your progress is saved.")) {
            stopConfetti();
            state.project = null;
            document.getElementById('menu-screen').style.display = 'block';
            document.getElementById('tracker-screen').style.display = 'none';
            save();
        }
    }

    function loadTracker() {
        if (!state.project) return;
        document.getElementById('menu-screen').style.display = 'none';
        document.getElementById('tracker-screen').style.display = 'block';
        document.getElementById('project-title').innerText = patterns[state.project].title;
        document.getElementById('abbr-content').innerHTML = patterns[state.project].abbr;
        updateDisplay();
    }

    function save() { localStorage.setItem('sophieState', JSON.stringify(state)); }

    function updateDisplay() {
        const pattern = patterns[state.project];
        if (!pattern) return;

        document.getElementById('step-text').innerHTML = pattern.steps[state.step].replace(/\n/g, "<br>");
        document.getElementById('step-count').innerText = `Step ${state.step + 1} of ${pattern.steps.length}`;
        document.getElementById('row-display').innerText = `Rows: ${state.rows}`;
        
        document.getElementById('prev-btn').disabled = state.step === 0;
        document.getElementById('next-btn').disabled = state.step === pattern.steps.length - 1;

        const shaping = pattern.shaping[state.step];
        const area = document.getElementById('shaping-area');
        if (shaping) {
            area.style.display = 'block';
            document.getElementById('shaping-label').innerText = shaping.label;
            let maxVal = shaping.total;
            if (state.project === 'hood' && state.step === 11) {
                const rates = [6, 8, 10];
                maxVal = rates[state.size];
            }
            document.getElementById('shaping-bar').max = maxVal;
            document.getElementById('shaping-bar').value = state.rows;
        } else {
            area.style.display = 'none';
        }

        if (state.project === 'hood') updateShapingPing();
        else document.getElementById('reminder-text').innerText = "";

        save();
        if(state.step === pattern.steps.length - 1) triggerConfetti();
        else stopConfetti();
    }

    function updateShapingPing() {
        const reminder = document.getElementById('reminder-text');
        reminder.innerText = "";
        const row = state.rows;
        const step = state.step;
        const rates = [6, 8, 10];
        const rate = rates[state.size];
        if (row === 0) return;

        const incCol = "var(--inc-color)", decCol = "var(--dec-color)", neutCol = "var(--neut-color)";

        if (step === 2) { 
            if ((row - 1) % rate === 0) { reminder.innerText = `üíñ ROW ${row} (WS): INCREASE\nK2, kfb, knit to last 3, slip 3`; reminder.style.color = incCol; }
            else { reminder.innerText = `üß∂ ROW ${row}: Work Even (Row ${((row - 1) % rate) + 1} of ${rate})`; reminder.style.color = neutCol; }
        } 
        else if (step === 3) {
            if (row === 1) { reminder.innerText = `üìå ROW 1 (WS): SETUP\nPlace 3 sts on holder, knit to last 3, slip 3`; reminder.style.color = "var(--hot-pink-accent)"; }
            else if (row % 2 === 0) { reminder.innerText = `üß∂ ROW ${row} (RS): Row 2\nKnit across`; reminder.style.color = neutCol; }
            else { reminder.innerText = `üß∂ ROW ${row} (WS): Row 3\nKnit to last 3, slip 3 wyif`; reminder.style.color = neutCol; }
        }
        else if (step === 4) {
            let cycle = (row - 1) % 4;
            if (cycle === 0) { reminder.innerText = `‚ö†Ô∏è ROW ${row} (RS): DECREASE\nKnit to last 3, k2tog, k1`; reminder.style.color = decCol; }
            else if (cycle === 2) { reminder.innerText = `üß∂ ROW ${row} (RS): Knit across`; reminder.style.color = neutCol; }
            else { reminder.innerText = `üß∂ ROW ${row} (WS): Knit to last 3, slip 3 wyif`; reminder.style.color = neutCol; }
        }
        else if (step === 5) {
            if ((row - 1) % 2 === 0) { reminder.innerText = `‚ö†Ô∏è ROW ${row} (RS): DECREASE\nKnit to last 3, k2tog, k1`; reminder.style.color = decCol; } 
            else { reminder.innerText = `üß∂ ROW ${row} (WS): Knit to last 3, slip 3 wyif`; reminder.style.color = neutCol; }
        }
        else if (step === 6) {
            reminder.innerText = (row % 2 !== 0) ? `‚ö†Ô∏è ROW ${row} (RS): k to last 3, k2tog, k1` : `‚ö†Ô∏è ROW ${row} (WS): k1, k2tog, k to last 3, slip 3`;
            reminder.style.color = decCol;
        }
        else if (step === 7) {
            reminder.innerText = (row % 2 !== 0) ? `üíñ ROW ${row} (RS): k to last 2, kfb, k1` : `üíñ ROW ${row} (WS): k1, kfb, k to last 3, slip 3`;
            reminder.style.color = incCol;
        }
        else if (step === 8) {
            if ((row - 1) % 2 === 0) { reminder.innerText = `üíñ ROW ${row} (RS): INCREASE\nKnit to last 2, kfb, k1`; reminder.style.color = incCol; } 
            else { reminder.innerText = `üß∂ ROW ${row} (WS): Knit to last 3, slip 3 wyif`; reminder.style.color = neutCol; }
        }
        else if (step === 9) {
            let cycle = (row - 1) % 4;
            if (cycle === 0) { reminder.innerText = `üß∂ ROW ${row} (RS): Knit across`; reminder.style.color = neutCol; }
            else if (cycle === 2) { reminder.innerText = `üíñ ROW ${row} (RS): INCREASE\nKnit to last 2, kfb, k1`; reminder.style.color = incCol; }
            else { reminder.innerText = `üß∂ ROW ${row} (WS): Knit to last 3, slip 3 wyif`; reminder.style.color = neutCol; }
        }
        else if (step === 10) {
            reminder.innerText = (row % 2 !== 0) ? `üß∂ ROW ${row} (RS): Knit across` : `üß∂ ROW ${row} (WS): Knit to last 3, slip 3`;
            reminder.style.color = neutCol;
        }
        else if (step === 11) {
            if (row === 1) { reminder.innerText = `üîó ROW 1 (RS): REJOIN\nKnit to end, pick up 3 sts from holder`; reminder.style.color = "var(--hot-pink-accent)"; } 
            else if (row % 2 === 0) { reminder.innerText = `üß∂ ROW ${row} (WS): Row 2\nKnit to last 3, slip 3 wyif`; reminder.style.color = neutCol; }
            else { reminder.innerText = `üß∂ ROW ${row} (RS): Row 3\nWork as Row 2 (Knit to last 3, slip 3)`; reminder.style.color = neutCol; }
        }
        else if (step === 12) {
            if ((row - 1) % rate === 0) { reminder.innerText = `‚ö†Ô∏è ROW ${row} (WS): DECREASE\nK3, skp, knit to last 3, slip 3 wyif`; reminder.style.color = decCol; } 
            else { reminder.innerText = `üß∂ ROW ${row}: Work Even (Row ${((row - 1) % rate) + 1} of ${rate})`; reminder.style.color = neutCol; }
        }
    }

    function changeRow(val) { state.rows = Math.max(0, state.rows + val); updateDisplay(); }
    function nextStep() { stopConfetti(); state.step++; state.rows = 0; updateDisplay(); }
    function prevStep() { stopConfetti(); state.step--; state.rows = 0; updateDisplay(); }
    function resetCounter() { state.rows = 0; updateDisplay(); }
    function updateSize(s) { state.size = s; updateDisplay(); }
    
    function stopConfetti() {
        confettiActive = false;
        if (confettiAnimId) cancelAnimationFrame(confettiAnimId);
        const canvas = document.getElementById('confetti');
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function triggerConfetti() {
        if (confettiActive) return;
        confettiActive = true;
        const canvas = document.getElementById('confetti');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        let particles = [];
        for(let i=0; i<50; i++) {
            particles.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height - canvas.height,
                size: Math.random() * 10 + 5,
                speed: Math.random() * 3 + 2,
                color: ['#F06292', '#F8BBD0', '#FF80AB'][Math.floor(Math.random()*3)]
            });
        }
        function draw() {
            if (!confettiActive) return;
            ctx.clearRect(0,0,canvas.width, canvas.height);
            particles.forEach(p => {
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
                ctx.fill();
                p.y += p.speed;
            });
            if(particles.length > 0 && particles[0].y < canvas.height) {
                confettiAnimId = requestAnimationFrame(draw);
            } else {
                confettiActive = false;
            }
        }
        draw();
    }

    if (state.project) loadTracker();
</script>

</body>
</html>
